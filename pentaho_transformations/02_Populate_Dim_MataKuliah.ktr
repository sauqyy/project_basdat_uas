<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>02_Populate_Dim_MataKuliah</name>
    <description>Populate DimMataKuliah from mata_kuliahs table</description>
    <extended_description>ETL Transformation to load DimMataKuliah dimension table from operational mata_kuliahs table.</extended_description>
    <trans_version>1.0</trans_version>
    <trans_type>Normal</trans_type>
    <directory>/</directory>
  </info>
  <order>
    <hop>
      <from>Table Input - MataKuliah</from>
      <to>Calculator - Generate Keys</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Calculator - Generate Keys</to>
      <to>Table Output - DimMataKuliah</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <steps>
    <step>
      <name>Table Input - MataKuliah</name>
      <type>TableInput</type>
      <description>Read from mata_kuliahs table</description>
      <connection>Operational_DB</connection>
      <sql>SELECT 
    id,
    kode_mk,
    nama_mk,
    sks,
    semester,
    prodi,
    kapasitas,
    deskripsi,
    tipe_kelas,
    menit_per_sks,
    ada_praktikum,
    sks_praktikum,
    sks_materi,
    created_at,
    updated_at
FROM mata_kuliahs
ORDER BY kode_mk;</sql>
      <limit>0</limit>
    </step>
    <step>
      <name>Calculator - Generate Keys</name>
      <type>Calculator</type>
      <description>Generate surrogate keys</description>
      <calculation>
        <field>
          <name>mata_kuliah_key</name>
          <type>String</type>
          <value>CONCAT('MK_', kode_mk)</value>
        </field>
        <field>
          <name>is_active</name>
          <type>Integer</type>
          <value>1</value>
        </field>
        <field>
          <name>valid_from</name>
          <type>Date</type>
          <value>created_at</value>
        </field>
        <field>
          <name>valid_to</name>
          <type>Date</type>
          <value>NULL</value>
        </field>
      </calculation>
    </step>
    <step>
      <name>Table Output - DimMataKuliah</name>
      <type>TableOutput</type>
      <description>Insert into DimMataKuliah</description>
      <connection>DW_Connection</connection>
      <table>dim_mata_kuliah</table>
      <commit>1000</commit>
      <use_batch>Y</use_batch>
      <specify_fields>Y</specify_fields>
      <fields>
        <field>
          <column>mata_kuliah_key</column>
          <name>mata_kuliah_key</name>
        </field>
        <field>
          <column>kode_mk</column>
          <name>kode_mk</name>
        </field>
        <field>
          <column>nama_mk</column>
          <name>nama_mk</name>
        </field>
        <field>
          <column>sks</column>
          <name>sks</name>
        </field>
        <field>
          <column>semester</column>
          <name>semester</name>
        </field>
        <field>
          <column>prodi</column>
          <name>prodi</name>
        </field>
        <field>
          <column>kapasitas</column>
          <name>kapasitas</name>
        </field>
        <field>
          <column>deskripsi</column>
          <name>deskripsi</name>
        </field>
        <field>
          <column>tipe_kelas</column>
          <name>tipe_kelas</name>
        </field>
        <field>
          <column>menit_per_sks</column>
          <name>menit_per_sks</name>
        </field>
        <field>
          <column>ada_praktikum</column>
          <name>ada_praktikum</name>
        </field>
        <field>
          <column>sks_praktikum</column>
          <name>sks_praktikum</name>
        </field>
        <field>
          <column>sks_materi</column>
          <name>sks_materi</name>
        </field>
        <field>
          <column>is_active</column>
          <name>is_active</name>
        </field>
        <field>
          <column>valid_from</column>
          <name>valid_from</name>
        </field>
        <field>
          <column>valid_to</column>
          <name>valid_to</name>
        </field>
      </fields>
    </step>
  </steps>
</transformation>

